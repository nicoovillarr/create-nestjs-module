# create-nestjs-module

Small CLI to scaffold a NestJS module inside an existing Nest app (features/modules layout), with optional tsconfig path aliasing and automatic AppModule import.

## Features
- Generate module folder structure (`application`, `domain`, `infrastructure`, `presentation`) and files from templates.
- Templates use replacements (e.g. `$ModuleName$`, `$EntityName$`).
- `$BaseDir$` is injected per-file: if `--add-tsconfig-path` is used it becomes an alias (`@/my-module`), otherwise a relative path from the generated file to the module root.
- Optionally updates `tsconfig.json` or `tsconfig.base.json` to add a path mapping for the new module.
- Optionally updates your `app.module.ts` to import and add the new module to the `imports` array.

## Requirements
- Node.js (14+ recommended)
- The tool assumes your Nest project has a `src/` folder and either `src/features/` or `src/modules/` exists. It will error if neither exists.

## Install
From the project root run:

```powershell
npm install
```

You can run the CLI with `npx` or `npm link`:

```powershell
npx create-module my-module
# or during development
# npm link
# create-module my-module
```

## Usage

```powershell
# Basic
npx create-module my-module

# Provide a custom entity name
npx create-module my-module -e my-entity

# Also add a tsconfig path alias and update AppModule
npx create-module my-module --add-tsconfig-path
```

Notes:
- `my-module` will be normalized to a safe kebab-case name (illegal characters removed). The CLI will error if the provided name contains path separators (`/` or `\\`).
- Templates expect `$BaseDir$/...` inside the templates. The generator replaces `$BaseDir$` with either `@/my-module` (when `--add-tsconfig-path` is used) or with a relative path such as `../../..` from the generated file to module root.

## What the script changes
- Creates the module folder at `src/features/<module>` or `src/modules/<module>` depending on which exists.
- Writes files using templates in `src/templates/` (you can edit these templates to change the generated content).
- When `--add-tsconfig-path` is passed:
  - Adds a `compilerOptions.paths` entry like `@/<module>/*` -> `./src/<features|modules>/<module>/*` in `tsconfig.json` or `tsconfig.base.json` (whichever exists first).
  - Uses `@/<module>` as `$BaseDir$` for imports.
- After generation the script tries to locate `app.module.ts` under `src/`, add an import for the new module and include it in the `imports` array of the `@Module` decorator. If it can't find or modify `app.module.ts` it will warn and continue.

## Files & organization
- `src/index.js` — CLI entry (orchestrator). Uses ESM `import` style.
- `src/libs/cli.js` — argument parsing (uses `commander`).
- `src/libs/generator.js` — generation logic, replacements, and writing files.
- `src/libs/tsconfig.js` — tsconfig path update helper.
- `src/libs/nestjs.js` — helper to update `app.module.ts`.
- `src/templates/` — file templates used by the generator (module, controller, service, repository, etc.).

## Customization
- Edit templates in `src/templates/` to change boilerplate.
- The `$BaseDir$` alias prefix is currently `@/` and hardcoded in the tsconfig and nestjs helpers; you can change that in `src/libs/tsconfig.js` and `src/libs/nestjs.js` if you'd like a different alias (for example `@app/` or `~/`).

## Safety and undo
- The script will overwrite files if they already exist. Use source control (git) to track or revert changes.
- I recommend committing before running the generator so you can inspect diffs and revert easily.

## Development notes
- The project uses ESM modules (top-level `import`). Run with Node versions that support ESM imports.
- To run tests (none are included yet), add your preferred test runner.

## Contributing
- PRs welcome: maintain template clarity and keep replacements consistent.

## License
- MIT (no license file included by default)

## Troubleshooting
- "We could not find a 'features' or 'modules' directory": create `src/features` or `src/modules`.
- `app.module.ts` not updated: check the file format; the updater tries to be tolerant but may not handle unusual decorator formatting.

If you want, I can add:
- A configurable alias prefix option.
- A dry-run mode that prints planned file writes and replacements.
- Backups before modifying `app.module.ts`.

---
Generated by create-nestjs-module
